@page "/disciplina/consulta"
@using BancoTalentos.Domain.Entity
@using BancoTalentos.Domain.Repositories.Contracts.Interfaces
@using BancoTalentos.UI.Components.Pages.Common

@inherits Page
@inject IDISCIPLINAS_REPOSITORY DisciplinaRepository

<Grid Data=@_disciplinas
      ColumnsDeclared=@GetColumns()
      ExpandMode="@expandMode"
      IsLoading=@IsLoading
      IsExportingCsv=@IsExportingCsv
      IsExportingExcel=@IsExportingExcel
      OnExportCSV="@(async args => await ExportCsv(GridComponent, EXPORT_FILE_NAME))"
      OnExportExcel="@(async args => await ExportExcel(GridComponent, EXPORT_FILE_NAME))"
      ShowActionsColumns=false
      RowRender="@RowRender"
      Render="OnCustomersDataGridRender"
      @ref="GridComponent">
    <Template Context="cousin">
        <Grid Data=@_disciplinas
              ColumnsDeclared=@GetColumns()
              IsLoading=@IsLoading
              IsExportingCsv=@IsExportingCsv
              IsExportingExcel=@IsExportingExcel
              OnExportCSV="@(async args => await ExportCsv(GridComponent, EXPORT_FILE_NAME))"
              OnExportExcel="@(async args => await ExportExcel(GridComponent, EXPORT_FILE_NAME))"
              ShowActionsColumns=false
              Render="@OnOrdersDataGridRender"
              RowRender="@RowRender"
              @ref="GridComponent">
              <Template Context="ant">
                  <RadzenText Text="Hello"></RadzenText>
              </Template>
        </Grid>
    </Template>
</Grid>

@code {
    DataGridExpandMode expandMode = DataGridExpandMode.Single;
    private IEnumerable<DISCIPLINAS> _disciplinas;
    private IEnumerable<GridColumn> _gridColumns;
    private Grid<DISCIPLINAS> GridComponent;
    private const string EXPORT_FILE_NAME = "Disciplinas";


    void OnCustomersDataGridRender(DataGridRenderEventArgs<DISCIPLINAS> args)
    {
        if (args.FirstRender)
        {
            InvokeAsync(() => args.Grid.ExpandRow(args.Grid.View.Where(c => c.QTD_PESSOAS_CAPACITADAS > 0).FirstOrDefault()));
        }
    }

    void OnOrdersDataGridRender(DataGridRenderEventArgs<DISCIPLINAS> args)
    {
        if (args.FirstRender)
        {
            InvokeAsync(() => args.Grid.ExpandRow(args.Grid.View.Where(c => c.QTD_PESSOAS_CAPACITADAS > 0).FirstOrDefault()));
        }
    }

    void RowRender(RowRenderEventArgs<DISCIPLINAS> args)
    {
        args.Expandable = args.Data.QTD_PESSOAS_CAPACITADAS > 0;
    }

    protected override async Task OnInitializedAsync()
    {
        ToogleLoading();
        try
        {
            _disciplinas = await DisciplinaRepository.GetAll_DetalhadoAsync();
        }
        catch (Exception ex)
        {
            NotificarErroCarregarDados(ex);
        }
        finally
        {
            ToogleLoading();
        }
    }

    private IList<GridColumn> GetColumns()
    {
        IList<GridColumn> output = [];

        output.Add(new GridColumn("Código", nameof(DISCIPLINAS.ID), new GridColumnOptions<IRadzenComponent>()
        {

        }));

        output.Add(new GridColumn("Carga horária", nameof(DISCIPLINAS.CARGA_HORARIA), new GridColumnOptions<IRadzenComponent>()
        {

        }));

        output.Add(new GridColumn("Nome", nameof(DISCIPLINAS.NOME), new GridColumnOptions<IRadzenComponent>()
        {

        }));

        output.Add(new GridColumn("Descrição", nameof(DISCIPLINAS.DESCRICAO), new GridColumnOptions<IRadzenComponent>()
            {
                Type = RadzenFormInputType.TextArea
            }));

        output.Add(new GridColumn("Qtd. pessoas capacitadas", nameof(DISCIPLINAS.QTD_PESSOAS_CAPACITADAS), new GridColumnOptions<IRadzenComponent>()
            {
                Type = RadzenFormInputType.TextBox
            }));

        return output;
    }
}
